<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Assembly Production Monitoring System - Dashboard">
    <meta name="author" content="Production Engineering Team">
    <title>Assembly Production Dashboard</title>
    <link rel="stylesheet" href="assets/styles/style.css">
</head>

<body>
    <!-- HEADER -->
    <header class="top">
        <div class="header-left">
            <img src="assets/img/logo1.png" alt="Company Logo" class="header-logo" onerror="this.style.display='none'">
            <div class="header-title">
                <h1>Assembly Production System</h1>
                <p class="muted">Monitoring & Analytics Dashboard ¬© 2026 Adham Morsy | Version 2.0.0</p>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-badge" id="userEmail">User</div>
                <div class="user-badge role-badge" id="userRole">Role</div>
            </div>
            <button id="auditLogsBtn" class="btn btn-secondary" style="display: none;" onclick="showAuditLogsModal()">
                üìã Audit Logs
            </button>
            <button id="logoutBtn" class="btn btn-logout">Logout</button>
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="container">

        <!-- USER MANAGEMENT (Master Admin Only) -->
        <section id="userManagementSection" class="card" style="display: none;">
            <div class="card-header">
                <h3>üë• User Management</h3>
                <button id="showAddUserBtn" class="btn btn-primary">+ Add User</button>
            </div>

            <!-- Add User Form (Hidden by default) -->
            <div id="addUserForm" class="form-section" style="display: none;">
                <h4>Add New User</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="newUsername">Username *</label>
                        <input type="text" id="newUsername" placeholder="Enter username" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Password *</label>
                        <input type="password" id="newPassword" placeholder="Enter password" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserRole">Role *</label>
                        <select id="newUserRole" required>
                            <option value="">Select role...</option>
                            <option value="master_admin">Master Admin</option>
                            <option value="admin">Admin</option>
                            <option value="viewer">Viewer</option>
                            <option value="customer">Customer</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button id="addUserBtn" class="btn btn-primary">Add User</button>
                    <button id="cancelAddUserBtn" class="btn btn-secondary">Cancel</button>
                    <p id="userError" class="error-msg"></p>
                    <p id="userSuccess" class="success-msg"></p>
                </div>
            </div>

            <!-- Users Table -->
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- SUMMARY CARDS -->
        <section class="summary-section">
            <div class="summary-grid">
                <div class="card summary-card">
                    <div class="card-icon">üöó</div>
                    <strong>Total Vehicles</strong>
                    <div class="big" id="totalVehicles">0</div>
                    <div class="muted">In Production</div>
                </div>
                <div class="card summary-card">
                    <div class="card-icon">‚úÖ</div>
                    <strong>Completed Stations</strong>
                    <div class="big" id="completedStations">0</div>
                    <div class="muted">All Vehicles</div>
                </div>
                <div class="card summary-card">
                    <div class="card-icon">‚è≥</div>
                    <strong>Pending Stations</strong>
                    <div class="big" id="pendingStations">0</div>
                    <div class="muted">Awaiting Work</div>
                </div>
                <div class="card summary-card">
                    <div class="card-icon">üìù</div>
                    <strong>Open Requests</strong>
                    <div class="big" id="openRequests">0</div>
                    <div class="muted">Pending Delivery</div>
                </div>
            </div>
        </section>

        <!-- TABS NAVIGATION -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="requests">üìù Requests</button>
            <button class="tab-btn" data-tab="production">üè≠ Production Status</button>
            <button class="tab-btn" data-tab="vehicles">üöó Vehicles</button>
            <button class="tab-btn" data-tab="analytics">üìä Analytics</button>
        </div>

        <!-- TAB CONTENT: REQUESTS -->
        <div id="requestsTab" class="tab-content active">

            <!-- Add Request Form (Admin, Customer, Master Admin) -->
            <section id="addRequestSection" class="card">
                <div class="card-header">
                    <h3>üìù Create New Request</h3>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="reqVehicleType">Vehicle Type *</label>
                        <select id="reqVehicleType" required>
                            <option value="">Select type...</option>
                            <option value="K9">K9</option>
                            <option value="K10">K10</option>
                            <option value="K11">K11</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reqVehicleNumber">Vehicle Number *</label>
                        <select id="reqVehicleNumber" required>
                            <option value="">Select vehicle...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reqStationCode">Station *</label>
                        <select id="reqStationCode" required>
                            <option value="">Select station...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reqType">Request Type *</label>
                        <select id="reqType" required>
                            <option value="">Select type...</option>
                            <option value="station">Station (Complete)</option>
                            <option value="part">Part (Specific)</option>
                        </select>
                    </div>
                </div>

                <!-- Part-specific fields (shown when type = part) -->
                <div id="partFields" class="form-grid" style="display: none;">
                    <div class="form-group">
                        <label for="reqPartNumber">Part Number *</label>
                        <input type="text" id="reqPartNumber" placeholder="e.g., MS90727-59">
                    </div>
                    <div class="form-group">
                        <label for="reqQty">Quantity *</label>
                        <input type="number" id="reqQty" min="1" placeholder="e.g., 4">
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="reqFastener">
                            <span>Fastener</span>
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button id="createRequestBtn" class="btn btn-primary">Create Request</button>
                    <p id="requestError" class="error-msg"></p>
                    <p id="requestSuccess" class="success-msg"></p>
                </div>
            </section>

            <!-- Requests Filter & Export -->
            <section class="card">
                <div class="card-header">
                    <h3>üîç Requests</h3>
                    <div class="header-actions">
                        <button id="exportRequestsPDF" class="btn btn-secondary">üìÑ Export PDF</button>
                        <button id="exportRequestsExcel" class="btn btn-secondary">üìä Export Excel</button>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus">
                            <option value="">All Status</option>
                            <option value="open">Open</option>
                            <option value="delivered">Delivered</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterReqType">Request Type</label>
                        <select id="filterReqType">
                            <option value="">All Types</option>
                            <option value="station">Station</option>
                            <option value="part">Part</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterVehicleType">Vehicle Type</label>
                        <select id="filterVehicleType">
                            <option value="">All Vehicles</option>
                            <option value="K9">K9</option>
                            <option value="K10">K10</option>
                            <option value="K11">K11</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterFastener">Fastener</label>
                        <select id="filterFastener">
                            <option value="">All</option>
                            <option value="yes">Fastener</option>
                            <option value="no">Not Fastener</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="searchRequest">Search</label>
                        <input type="text" id="searchRequest" placeholder="Part number, vehicle...">
                    </div>
                </div>

                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Vehicle</th>
                                <th>Station</th>
                                <th>Type</th>
                                <th>Part Number</th>
                                <th>Qty</th>
                                <th>Fastener</th>
                                <th>Status</th>
                                <th>Requested By</th>
                                <th>Request Date</th>
                                <th>Delivery Date</th>
                                <th id="actionsHeader">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- TAB CONTENT: PRODUCTION STATUS -->
        <div id="productionTab" class="tab-content">

            <!-- Add Vehicle Form (Admin, Master Admin) -->
            <section id="addVehicleSection" class="card" style="display: none;">
                <div class="card-header">
                    <h3>üöó Add New Vehicle</h3>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="newVehicleType">Vehicle Type *</label>
                        <select id="newVehicleType" required>
                            <option value="">Select type...</option>
                            <option value="K9">K9</option>
                            <option value="K10">K10</option>
                            <option value="K11">K11</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newVehicleNumber">Vehicle Number *</label>
                        <input type="text" id="newVehicleNumber" placeholder="e.g., K9-M3" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button id="addVehicleBtn" class="btn btn-primary">Add Vehicle</button>
                    <p id="vehicleError" class="error-msg"></p>
                    <p id="vehicleSuccess" class="success-msg"></p>
                </div>
            </section>

            <!-- Production Status Filter -->
            <section class="card">
                <div class="card-header">
                    <h3>üè≠ Production Status</h3>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="filterProdVehicle">Select Vehicle</label>
                        <select id="filterProdVehicle">
                            <option value="">All Vehicles</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterProdStatus">Status</label>
                        <select id="filterProdStatus">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Vehicle Number</th>
                                <th>Station</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                                <th id="prodActionsHeader">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productionTableBody"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- TAB CONTENT: VEHICLES -->
        <div id="vehiclesTab" class="tab-content">
            <section class="card">
                <div class="card-header">
                    <h3>üöó Vehicles</h3>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="filterVehicles">Vehicle Type</label>
                        <select id="filterVehicles">
                            <option value="">All Types</option>
                            <option value="K9">K9</option>
                            <option value="K10">K10</option>
                            <option value="K11">K11</option>
                        </select>
                    </div>
                </div>

                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Vehicle Number</th>
                                <th>Type</th>
                                <th>Total Stations</th>
                                <th>Completed</th>
                                <th>In Progress</th>
                                <th>Pending</th>
                                <th>Progress</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="vehiclesTableBody"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- TAB CONTENT: ANALYTICS -->
        <div id="analyticsTab" class="tab-content">
            <section class="card">
                <div class="card-header">
                    <h3>üìä Analytics Dashboard</h3>
                    <button id="exportAnalyticsPDF" class="btn btn-secondary">üìÑ Export Report</button>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h4>Production Status by Vehicle Type</h4>
                        <canvas id="productionByTypeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Request Status Distribution</h4>
                        <canvas id="requestStatusChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Requests Timeline (Last 30 Days)</h4>
                        <canvas id="requestTimelineChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Request Type Breakdown</h4>
                        <canvas id="requestTypeChart"></canvas>
                    </div>
                </div>
            </section>
        </div>

    </div>

    <!-- FOOTER -->
    <footer>
        <p>&copy; 2026 Adham Morsy | Version 2.0.0</p>
    </footer>

    <!-- CDN LIBRARIES -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- APPLICATION SCRIPT -->
    <script src="assets/scripts/app.js"></script>
</body>

</html>